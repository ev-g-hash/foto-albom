{% extends 'base.html' %}
{% load static %}

{% block title %}Галерея{% endblock %}

{% block content %}
<section id="page-gallery" class="page" aria-labelledby="gallery-title">
  <div class="card stack-lg">
    <h2 id="gallery-title">Приятные моменты</h2>

    <div class="gallery" id="gallery" data-total-photos="{{ photos_list.count|default:page_obj.paginator.count }}">
      {% for photo in page_obj.object_list %}
      <div class="photo">
        <img src="{{ photo.image.url }}" alt="{{ photo.title|default:'Фото' }}" loading="lazy" data-full="{{ photo.image.url }}" data-title="{{ photo.title|default:'' }}" data-desc="{{ photo.description|default:'' }}">
        {% if photo.description %}
        <div class="photo-desc">
          <a href="{% url 'photo_detail' photo.pk %}">{{ photo.description }}</a>
        </div>
        {% endif %}
      </div>
      {% empty %}
      <p>Пока нет загруженных фотографий. Добавьте их через админку.</p>
      {% endfor %}
    </div>

    <nav class="pagination">
      {% if page_obj.has_previous %}
        <a class="btn" href="?page={{ page_obj.previous_page_number }}{% if per_page != 3 %}&per_page={{ per_page }}{% endif %}">Назад</a>
      {% endif %}
      <span class="page-info">Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}</span>
      {% if page_obj.has_next %}
        <a class="btn" href="?page={{ page_obj.next_page_number }}{% if per_page != 3 %}&per_page={{ per_page }}{% endif %}">Далее</a>
      {% endif %}
    </nav>

    <div class="btn-row">
      <a id="to-code" class="btn secondary" href="{% url 'conclusion' %}">Содержание</a>
      <a id="back-to-greeting" class="btn" href="/">На главную</a>
    </div>
  </div>
</section>

<div id="lightbox" class="lightbox" aria-modal="true" role="dialog" aria-label="Просмотр изображения">
  <img id="lightbox-img" alt="Увеличенное фото">
</div>

<!-- Добавляем скрытый элемент с общим количеством фото для JavaScript -->
<script type="application/json" id="gallery-data">
{
  "totalPhotos": {{ photos_list.count|default:page_obj.paginator.count }},
  "currentPage": {{ page_obj.number }},
  "totalPages": {{ page_obj.paginator.num_pages }}
}
</script>
{% endblock %}